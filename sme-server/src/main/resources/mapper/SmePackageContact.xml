<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sme.mapper.SmePackageContactMapper">

    <!-- 结果映射：匹配实体类和数据库字段 -->
    <resultMap id="SmePackageContactResultMap" type="com.sme.entity.SmePackageContact">
        <id column="id" property="id"/>
        <result column="package_no" property="packageNo"/>
        <result column="process_status" property="processStatus"/>
        <result column="dept_id" property="deptId"/>
        <result column="leader_name" property="leaderName"/>
        <result column="enterprise_id" property="enterpriseId"/>
        <!-- 新增的冗余字段映射 -->
        <result column="enterprise_name" property="enterpriseName"/>
        <result column="enterprise_leader" property="enterpriseLeader"/>
        <result column="enterprise_phone" property="enterprisePhone"/>
        <result column="class_monitor" property="classMonitor"/>
        <result column="class_dept_name" property="classDeptName"/>
        <result column="class_phone" property="classPhone"/>
        <!-- 原有核心字段映射 -->
        <result column="enterprise_problem" property="enterpriseProblem"/>
        <result column="problem_receive_time" property="problemReceiveTime"/>
        <result column="problem_type" property="problemType"/>
        <result column="handle_result" property="handleResult"/>
        <result column="handle_content" property="handleContent"/>
        <result column="unable_reason" property="unableReason"/>
        <result column="complete_time" property="completeTime"/>
        <result column="handle_remark" property="handleRemark"/>
        <result column="remark" property="remark"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="del_flag" property="delFlag"/>
    </resultMap>

    <!-- 分页查询SQL：支持多条件模糊/精准筛选，仅查询未删除的数据 -->
    <select id="pageQuery" resultMap="SmePackageContactResultMap">
        SELECT
        id,
        package_no,
        process_status,
        leader_name,
        enterprise_id,
        enterprise_name,
        enterprise_leader,
        enterprise_phone,
        class_monitor,
        class_dept_name,
        class_phone,
        enterprise_problem,
        problem_receive_time,
        problem_type,
        handle_result,
        handle_content,
        unable_reason,
        complete_time,
        handle_remark,
        remark,
        create_time,
        update_time,
        del_flag
        FROM gh_sme_service.sme_package_contact
        WHERE del_flag = 0
        <!-- 流程状态筛选：精准匹配 -->
        <if test="processStatus != null and processStatus != ''">
            AND process_status = #{processStatus}
        </if>
        <!-- 包抓领导姓名：模糊查询 -->
        <if test="leaderName != null and leaderName != ''">
            AND leader_name LIKE CONCAT('%', #{leaderName}, '%')
        </if>
        <!-- 企业名称：模糊查询 -->
        <if test="enterpriseName != null and enterpriseName != ''">
            AND enterprise_name LIKE CONCAT('%', #{enterpriseName}, '%')
        </if>
        <!-- 专班班长：模糊查询 -->
        <if test="classMonitor != null and classMonitor != ''">
            AND class_monitor LIKE CONCAT('%', #{classMonitor}, '%')
        </if>
        <!-- 专班负责单位名称：模糊查询 -->
        <if test="classDeptName != null and classDeptName != ''">
            AND class_dept_name LIKE CONCAT('%', #{classDeptName}, '%')
        </if>
        <!-- 问题类型：精准匹配 -->
        <if test="problemType != null and problemType != ''">
            AND problem_type = #{problemType}
        </if>
        <!-- 排序：按更新时间倒序，保证最新数据在前 -->
        ORDER BY update_time DESC
    </select>

</mapper>